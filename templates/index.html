<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Global Temperature Anomaly Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
      body {
        background-color: #f8f9fa;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      .main-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }
      .chart-container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        padding: 20px;
        margin: 20px 0;
      }
      .controls-panel {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        padding: 20px;
        margin: 20px 0;
      }
      .dataset-toggle {
        margin: 5px 0;
      }
      .trend-controls {
        border-left: 3px solid #007bff;
        padding-left: 15px;
        margin: 15px 0;
      }
      .export-controls {
        border-left: 3px solid #28a745;
        padding-left: 15px;
        margin: 15px 0;
      }
      .stats-panel {
        background: #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin: 10px 0;
      }
      #statusIndicator {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
      }
      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }
      #myChart {
        height: 400px !important;
        max-height: 400px;
      }
      
      /* Dark Mode Styles */
      [data-bs-theme="dark"] {
        background-color: #1a1a1a !important;
        color: #ffffff !important;
      }
      
      [data-bs-theme="dark"] body {
        background-color: #1a1a1a !important;
        color: #ffffff !important;
      }
      
      [data-bs-theme="dark"] .chart-container,
      [data-bs-theme="dark"] .controls-panel {
        background-color: #2d2d2d !important;
        border: 1px solid #404040;
        color: #ffffff !important;
      }
      
      [data-bs-theme="dark"] .stats-panel {
        background-color: #404040 !important;
        color: #ffffff !important;
      }
      
      [data-bs-theme="dark"] .form-control,
      [data-bs-theme="dark"] .form-select {
        background-color: #404040 !important;
        border-color: #555555 !important;
        color: #ffffff !important;
      }
      
      [data-bs-theme="dark"] .form-control:focus,
      [data-bs-theme="dark"] .form-select:focus {
        background-color: #404040 !important;
        border-color: #0d6efd !important;
        color: #ffffff !important;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important;
      }
      
      [data-bs-theme="dark"] .btn-outline-primary {
        color: #6ea8fe !important;
        border-color: #6ea8fe !important;
      }
      
      [data-bs-theme="dark"] .btn-outline-primary:hover {
        background-color: #6ea8fe !important;
        border-color: #6ea8fe !important;
        color: #000 !important;
      }
      
      [data-bs-theme="dark"] .btn-outline-secondary {
        color: #adb5bd !important;
        border-color: #adb5bd !important;
      }
      
      [data-bs-theme="dark"] .btn-outline-secondary:hover {
        background-color: #adb5bd !important;
        border-color: #adb5bd !important;
        color: #000 !important;
      }
      
      [data-bs-theme="dark"] .text-muted {
        color: #adb5bd !important;
      }
      
      [data-bs-theme="dark"] footer {
        color: #adb5bd !important;
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <!-- Header -->
      <div class="row">
        <div class="col-12 position-relative">
          <!-- Dark Mode Toggle -->
          <div class="position-absolute top-0 end-0">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="darkModeToggle">
              <label class="form-check-label" for="darkModeToggle">
                <i id="darkModeIcon" class="fas fa-moon"></i>
              </label>
            </div>
          </div>
          
          <h1 class="display-4 text-center mb-4">
            <i class="fas fa-thermometer-half text-danger"></i>
            Global Temperature Anomaly Analysis
          </h1>
          <p class="lead text-center text-muted">
            Interactive visualization of GISS, CRUTEM, and GHCN temperature datasets
          </p>
        </div>
      </div>

      <!-- Status Indicator -->
      <div id="statusIndicator"></div>

      <!-- Controls Panel -->
      <div class="row">
        <div class="col-lg-3 col-md-4">
          <div class="controls-panel">
            <h5><i class="fas fa-sliders-h"></i> Visualization Controls</h5>
            
            <!-- Dataset Toggles -->
            <div class="mb-4">
              <h6>Datasets</h6>
              <div class="dataset-toggle">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="toggleGISS" checked>
                  <label class="form-check-label" for="toggleGISS">
                    <span style="color: rgb(255, 99, 132);">●</span> NASA GISTEMP
                  </label>
                </div>
              </div>
              <div class="dataset-toggle">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="toggleGHCN" checked>
                  <label class="form-check-label" for="toggleGHCN">
                    <span style="color: rgb(54, 162, 235);">●</span> GHCN Raw (Simple)
                  </label>
                </div>
              </div>
              <div class="dataset-toggle">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="toggleCRUTEM" checked>
                  <label class="form-check-label" for="toggleCRUTEM">
                    <span style="color: rgb(75, 192, 192);">●</span> CRUTEM5
                  </label>
                </div>
              </div>
            </div>

            <!-- Time Range Selector -->
            <div class="mb-4">
              <h6>Time Range</h6>
              <div class="row">
                <div class="col-6">
                  <label for="startYear" class="form-label">Start Year</label>
                  <input type="number" class="form-control form-control-sm" id="startYear" min="1880" max="2024">
                </div>
                <div class="col-6">
                  <label for="endYear" class="form-label">End Year</label>
                  <input type="number" class="form-control form-control-sm" id="endYear" min="1880" max="2024">
                </div>
              </div>
              <button class="btn btn-outline-primary btn-sm mt-2" id="applyTimeRange">
                <i class="fas fa-calendar-alt"></i> Apply Range
              </button>
              <button class="btn btn-outline-secondary btn-sm mt-2" id="resetTimeRange">
                <i class="fas fa-undo"></i> Reset
              </button>
            </div>

            <!-- Trend Analysis -->
            <div class="trend-controls">
              <h6><i class="fas fa-chart-line"></i> Trend Analysis</h6>
              <div class="mb-2">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="showDataSeries" checked>
                  <label class="form-check-label" for="showDataSeries">
                    <strong>Show Data Series</strong>
                  </label>
                </div>
              </div>
              <div class="mb-2">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="showLinearTrend">
                  <label class="form-check-label" for="showLinearTrend">
                    Linear Regression
                  </label>
                </div>
              </div>
              <div class="mb-2">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="showMovingAverage">
                  <label class="form-check-label" for="showMovingAverage">
                    Moving Average
                  </label>
                </div>
              </div>
              <div class="mb-2" id="movingAverageControls" style="display: none;">
                <label for="movingAverageYears" class="form-label">Years:</label>
                <select class="form-select form-select-sm" id="movingAverageYears">
                  <option value="5">5 years</option>
                  <option value="10" selected>10 years</option>
                  <option value="15">15 years</option>
                  <option value="20">20 years</option>
                </select>
              </div>
            </div>

            <!-- Export Controls -->
            <div class="export-controls">
              <h6><i class="fas fa-download"></i> Export Data</h6>
              <button class="btn btn-success btn-sm mb-2 w-100" id="exportCSV">
                <i class="fas fa-file-csv"></i> Download CSV
              </button>
              <button class="btn btn-info btn-sm mb-2 w-100" id="exportPNG">
                <i class="fas fa-image"></i> Download Chart
              </button>
            </div>

            <!-- Statistics Panel -->
            <div class="stats-panel" id="statsPanel">
              <h6><i class="fas fa-calculator"></i> Statistics</h6>
              <div id="statisticsContent">
                <small class="text-muted">Select datasets to view statistics</small>
              </div>
              <button class="btn btn-outline-info btn-sm mt-2" id="advancedAnalysis" style="display: none;">
                <i class="fas fa-chart-bar"></i> Advanced Analysis
              </button>
            </div>

            <!-- Advanced Statistics Modal -->
            <div class="modal fade" id="advancedStatsModal" tabindex="-1">
              <div class="modal-dialog modal-lg">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">
                      <i class="fas fa-chart-bar"></i> Advanced Statistical Analysis
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body" id="advancedStatsContent">
                    <div class="text-center">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading analysis...</span>
                      </div>
                      <p class="mt-2">Calculating advanced statistics...</p>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Chart Area -->
        <div class="col-lg-9 col-md-8">
          <div class="chart-container">
            <div class="loading" id="loadingIndicator">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <p>Loading climate data...</p>
            </div>
            <canvas id="myChart" style="display: none; height: 400px;"></canvas>
            
            <!-- Trend Slopes Display -->
            <div id="trendSlopesDisplay" class="mt-3" style="display: none;">
              <h6><i class="fas fa-chart-line"></i> Linear Trend Slopes</h6>
              <div id="trendSlopesContent" class="small">
                <!-- Trend slopes will be populated here -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="row mt-4">
        <div class="col-12">
          <footer class="text-center text-muted">
            <small>
              Data sources: NASA GISS, HadCRUT/CRUTEM5, NOAA GHCN-Monthly v4 | 
              Temperature anomalies relative to 1951-1980 baseline
            </small>
          </footer>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="static/index.js"></script>
  </body>
</html>
